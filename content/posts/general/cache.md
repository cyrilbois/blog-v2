---
title: 캐시(cache)
date: '2022-12-03'
tags: ['general', 'web']
draft: true
---


## 캐시란?

캐시(Cache)는 데이터나 값을 미리 복사해 놓는 임시 장소를 가리킨다. 캐시는 원래 데이터를 접근하는 시간이 오래 걸리거나, 값을 다시 계산하는 시간을 절약하고 싶을 때 사용한다.

특히 웹 서비스에서는 사용하는 이미지나 자바스크립트 파일을 매번 네트워크를 통해 불러오지 않고 최초에만 다운로드하여 캐시에 저장해 두고 그 이후 요청 시에는 저장해 둔 파일을 사용한다.


## 캐시의 종류

[AWS 캐싱](https://aws.amazon.com/ko/caching/) 설명에 따르면, 캐싱은 데이터베이스 캐싱, CDN 캐싱, 웹 캐싱, 일반 캐시, 세션 관리 이렇게 5가지 유형으로 나뉜다.


### 웹 캐싱

웹에서 사용하는 캐시는 크게 두 가지로 구분할 수 있다.

- 메모리 캐시: 메모리에 저장하는 방식. 메모리란 RAM을 뜻한다
- 디스크 캐시: 파일 형태로 디스크에 저장하는 방식.

어떤 캐시를 사용할지는 직접 제어할 수 없다. 브라우저가 사용 빈도나 파일 크기에 따라 특정 알고리즘에 의해 알아서 처리한다.


## Cache-Control

브라우저가 캐시를 하기 위해서는 Cache-Control이라는 헤더가 응답 헤더에 있어야 한다.

Cache-Control은 리소스의 응답 헤더에 설정되는 헤더다. 브라우저는 서버에서 이 헤더를 통해 캐시를 어떻게, 얼마나 적용해야 하는지 판단한다.

대표적으로 아래 5가지 값이 조합되어 들어간다.

- no-cache: 캐시를 사용하기 전 서버에 검사 후 사용
- no-store: 캐시 사용 안함
- public: 모든 환경에서 캐시 사용 가능
- private: 브라우저 환경에서만 캐시 사용, 외부 캐시 서버에서는 사용 불가
- max-age: 캐시의 유효 시간

no-cache는 사용 전에 서버에 캐시된 리소스를 사용해도 되는지 한 번 체크하도록 하는 옵션이다.

public이나 private로 설정하면 max-age에서 설정한 시간만큼은 서버에 사용 가능 여부를 묻지 않고 캐시된 리소스를 바로 사용한다. 만약 유효 시간이 지났다면 서버에 캐시된 리소스를 사용해도 되는지 다시 체크하고 유효 시간만큼 더 사용한다.

웹 리소스는 브라우저뿐만 아니라 웹 서버와 브라우저 사이를 연결하는 중간 캐시 서버에서도 캐시 될 수 있다. 만약 중간 서버에서 캐시를 적용하고 싶지 않다면 private 옵션을 사용한다.

max-age는 초 단위로 얼마나 오래 캐시를 사용할 것인지 설정한다.

```
Cache-Control: public, max-age=0
// 모든 환경에서 0초 동안 캐시를 사용. 0초는 사실상 캐시가 바로 만료되는 상태이므로 매번 서버에 캐시를 사용해도 되는지 확인한다. 즉, no-cache와 동일하다
```

### 적절한 캐시 유효 시간 p174

리소스마다 사용이나 변경 빈도가 달라 캐시의 유효 시간도 달라져야 한다.

일반적으로 HTML 파일에는 no-cache 설정을 적용한다. 항상 최신 버전의 웹 서비스를 적용해야 하기 때문이다. HTML이 캐시되면 캐시된 HTML에서 이전 버전의 자바스크립트나 CSS를 로드하게 되므로 캐시 시간 동안 최신 버전의 웹 서비스를 제공하지 못한다. 따라서 항상 최신 버전의 리소스를 제공하면서도 변경 사항이 없을 때만 캐시를 사용하는 no-cache 설정을 적용한다.

하지만 자바스크립트나 CSS는 다르다. 빌드된 자바스크립트와 CSS는 파일명에 해시를 함께 갖고 있다. 즉, 코드가 변경되면 해시도 변경되어 완전히 다른 파일이 되어 버린다. 따라서 캐시를 아무리 오래 적용해도 HTML만 최신 상태라면 자바스크립트나 CSS 파일은 당연히 최신 리소스를 로드한다. 이미지도 마찬가지다.


**참조**

- [캐싱 | AWS](https://aws.amazon.com/ko/caching/)
